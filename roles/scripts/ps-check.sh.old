#!/bin/bash
  
echo "ğŸ“¦ ì „ì²´ ì‹œìŠ¤í…œ í¬íŠ¸-í”„ë¡œì„¸ìŠ¤ ë§¤í•‘ ì§„ë‹¨ ì‹œì‘"

# í¬íŠ¸, í”„ë¡œí† ì½œ, PID, í”„ë¡œì„¸ìŠ¤ ìˆ˜ì§‘
ss -tulnp 2>/dev/null | tail -n +2 | while read -r line; do
  proto=$(echo $line | awk '{print $1}')
  local_addr=$(echo $line | awk '{print $5}')
  pidprog=$(echo $line | awk '{print $7}' | sed 's/\"//g')

  # í¬íŠ¸ ë²ˆí˜¸ ì¶”ì¶œ
  port=$(echo "$local_addr" | awk -F':' '{print $NF}')
  pid=$(echo "$pidprog" | cut -d'/' -f1)
  pname=$(echo "$pidprog" | cut -d'/' -f2)

  # PIDê°€ ì—†ìœ¼ë©´ ìŠ¤í‚µ
  [[ -z "$port" || -z "$pid" || "$pid" == "-" ]] && continue

  # í”„ë¡œì„¸ìŠ¤ëª…ì´ ë¹„ì–´ ìˆìœ¼ë©´ psë¡œ í™•ì¸
  if [[ -z "$pname" ]]; then
    pname=$(ps -p $pid -o comm= 2>/dev/null)
  fi

  # í”„ë¡œì„¸ìŠ¤ëª…ì´ ë¹„ì–´ë„ ë§ˆì§€ë§‰ ì‹œë„
  [[ -z "$pname" ]] && pname=$(cat /proc/$pid/comm 2>/dev/null)

  # /etc/services ì—ì„œ ê³µì‹ ì„œë¹„ìŠ¤ëª… ì¶”ì¶œ ì‹œë„
  svcname=$(getent services $port | awk '{print $1}' | head -n 1)

  # ì¶”ì • ì„œë¹„ìŠ¤ = í”„ë¡œì„¸ìŠ¤ëª… + /etc/services ê¸°ë°˜ í˜¼í•©
  guess="${pname:-unknown}"
  [[ -n "$svcname" ]] && guess="$guess / $svcname"

  echo "[$proto] í¬íŠ¸ $port â†’ PID $pid â†’ í”„ë¡œì„¸ìŠ¤ëª…: $pname â†’ ì¶”ì • ì„œë¹„ìŠ¤
: $guess"
done

echo
echo "âœ… ì „ì²´ í¬íŠ¸/í”„ë¡œì„¸ìŠ¤ ì§„ë‹¨ ì™„ë£Œ"
